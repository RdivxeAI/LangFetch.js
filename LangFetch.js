/*!
 * LangFetch.js Library (Patched)
 * Natural Language HTTP/JSON/FormData Requests
 * Author: Amr Twig
 * Company: Rdivxe LLC
 * Description: Enhanced to auto-run new <prompt> elements even if added after load.
 */
const LangFetch={values:{},definePlaceholder(t,r="string"){if(!this.values[t]){let e;switch(r.toLowerCase()){case"object":case"array":e={};break;case"number":e=0;break;case"boolean":e=!1;break;default:e=""}this.values[t]=e,window.hasOwnProperty(t)||Object.defineProperty(window,t,{get:()=>this.values[t],set:e=>{this.values[t]=e}})}},parsePrompt(e){var t=e.match(/في\s*(?:المتغير|variable)\s+([a-zA-Z0-9_]+)(?:\s+من النوع\s+([a-zA-Z0-9_]+))?/i);if(!t)return null;var r=t[1],t=t[2]||"string",a=(this.definePlaceholder(r,t),e.match(/https?:\/\/[^\s]+/));if(!a)return null;var a=a[0],o=/(ابعت|send)/i.test(e)?"POST":"GET";let n=null;var s=e.match(/params\s*[:=]\s*(\{.*\})/i);if(s)try{n=JSON.parse(s[1])}catch(e){n=null}s=e.match(/(?:ارفع|upload)\s+([a-zA-Z0-9_]+)/i);return s&&this.values[s[1]]instanceof File&&(n=n||new FormData).append(s[1],this.values[s[1]]),{varName:r,type:t,url:a,method:o,body:n}},async run(r){if(!(r=this.parsePrompt(r)))return null;var e={method:r.method};"POST"===r.method&&r.body&&(r.body instanceof FormData||"object"!=typeof r.body?e.body=r.body:(e.body=JSON.stringify(r.body),e.headers={"Content-Type":"application/json"}));try{var a=await(await fetch(r.url,e)).text();let t;try{switch(r.type.toLowerCase()){case"object":case"array":t=JSON.parse(a);break;case"number":t=Number(a);break;case"boolean":t="true"===a.trim().toLowerCase();break;default:t=a}}catch(e){t=a}return window[r.varName]=t}catch(e){return console.error("LangFetch Error:",e),window[r.varName]=null}},runAllPrompts(){document.querySelectorAll("prompt").forEach(e=>this.run(e.textContent))},async repeat(t,r=1){var a=[];for(let e=0;e<r;e++)a.push(await this.run(t));return a}};!function(){const t=[];let e=!0;"function"!=typeof window.pro&&(e=!1,window.pro=e=>t.push(e));var r=()=>{if(window.pro&&"function"==typeof window.pro){for(;t.length;)LangFetch.run(t.shift());e=!0}};LangFetch.runAllPrompts(),r(),new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{1===e.nodeType&&(e.tagName&&"prompt"===e.tagName.toLowerCase()?LangFetch.run(e.textContent):e.querySelectorAll&&e.querySelectorAll("prompt").forEach(e=>{LangFetch.run(e.textContent)}))})})}).observe(document.documentElement||document.body,{childList:!0,subtree:!0}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",r,{once:!0}):r()}(),window.proRepeat=(e,t=1)=>LangFetch.repeat(e,t);
